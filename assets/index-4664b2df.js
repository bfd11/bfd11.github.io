import{i as ir,g as nr,d as sr,a as Fe,s as or,r as $e,b as Ae,c as hr,m as Ce}from"./mobile-cb4ecf15.js";import{fn as ar,dE as fr,gy as Lt,gN as ur,eg as Ne}from"./index-40f6b818.js";import{i as cr}from"./index-17ea54f7.js";import{p as lr,c as Ct}from"./format-ed83eaa6.js";import{s as dr,a as pr,d as mr}from"./index-44c8c2a4.js";import"./index-b1693c30.js";import"./tslib.es6-c2094241.js";const gr=["session_request","session_update","exchange_key","connect","disconnect","display_uri","modal_closed","transport_open","transport_close","transport_error"],Ze=["eth_sendTransaction","eth_signTransaction","eth_sign","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v2","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"];var fe={},vr={get exports(){return fe},set exports(a){fe=a}};(function(a){(function(i,u){function p(l,t){if(!l)throw new Error(t||"Assertion failed")}function v(l,t){l.super_=t;var r=function(){};r.prototype=t.prototype,l.prototype=new r,l.prototype.constructor=l}function c(l,t,r){if(c.isBN(l))return l;this.negative=0,this.words=null,this.length=0,this.red=null,l!==null&&((t==="le"||t==="be")&&(r=t,t=10),this._init(l||0,t||10,r||"be"))}typeof i=="object"?i.exports=c:u.BN=c,c.BN=c,c.wordSize=26;var T;try{T=ar.Buffer}catch{}c.isBN=function(t){return t instanceof c?!0:t!==null&&typeof t=="object"&&t.constructor.wordSize===c.wordSize&&Array.isArray(t.words)},c.max=function(t,r){return t.cmp(r)>0?t:r},c.min=function(t,r){return t.cmp(r)<0?t:r},c.prototype._init=function(t,r,n){if(typeof t=="number")return this._initNumber(t,r,n);if(typeof t=="object")return this._initArray(t,r,n);r==="hex"&&(r=16),p(r===(r|0)&&r>=2&&r<=36),t=t.toString().replace(/\s+/g,"");var s=0;t[0]==="-"&&s++,r===16?this._parseHex(t,s):this._parseBase(t,r,s),t[0]==="-"&&(this.negative=1),this.strip(),n==="le"&&this._initArray(this.toArray(),r,n)},c.prototype._initNumber=function(t,r,n){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[t&67108863],this.length=1):t<4503599627370496?(this.words=[t&67108863,t/67108864&67108863],this.length=2):(p(t<9007199254740992),this.words=[t&67108863,t/67108864&67108863,1],this.length=3),n==="le"&&this._initArray(this.toArray(),r,n)},c.prototype._initArray=function(t,r,n){if(p(typeof t.length=="number"),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var f,d,m=0;if(n==="be")for(s=t.length-1,f=0;s>=0;s-=3)d=t[s]|t[s-1]<<8|t[s-2]<<16,this.words[f]|=d<<m&67108863,this.words[f+1]=d>>>26-m&67108863,m+=24,m>=26&&(m-=26,f++);else if(n==="le")for(s=0,f=0;s<t.length;s+=3)d=t[s]|t[s+1]<<8|t[s+2]<<16,this.words[f]|=d<<m&67108863,this.words[f+1]=d>>>26-m&67108863,m+=24,m>=26&&(m-=26,f++);return this.strip()};function mt(l,t,r){for(var n=0,s=Math.min(l.length,r),f=t;f<s;f++){var d=l.charCodeAt(f)-48;n<<=4,d>=49&&d<=54?n|=d-49+10:d>=17&&d<=22?n|=d-17+10:n|=d&15}return n}c.prototype._parseHex=function(t,r){this.length=Math.ceil((t.length-r)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var s,f,d=0;for(n=t.length-6,s=0;n>=r;n-=6)f=mt(t,n,n+6),this.words[s]|=f<<d&67108863,this.words[s+1]|=f>>>26-d&4194303,d+=24,d>=26&&(d-=26,s++);n+6!==r&&(f=mt(t,r,n+6),this.words[s]|=f<<d&67108863,this.words[s+1]|=f>>>26-d&4194303),this.strip()};function I(l,t,r,n){for(var s=0,f=Math.min(l.length,r),d=t;d<f;d++){var m=l.charCodeAt(d)-48;s*=n,m>=49?s+=m-49+10:m>=17?s+=m-17+10:s+=m}return s}c.prototype._parseBase=function(t,r,n){this.words=[0],this.length=1;for(var s=0,f=1;f<=67108863;f*=r)s++;s--,f=f/r|0;for(var d=t.length-n,m=d%s,o=Math.min(d,d-m)+n,e=0,h=n;h<o;h+=s)e=I(t,h,h+s,r),this.imuln(f),this.words[0]+e<67108864?this.words[0]+=e:this._iaddn(e);if(m!==0){var _=1;for(e=I(t,h,t.length,r),h=0;h<m;h++)_*=r;this.imuln(_),this.words[0]+e<67108864?this.words[0]+=e:this._iaddn(e)}},c.prototype.copy=function(t){t.words=new Array(this.length);for(var r=0;r<this.length;r++)t.words[r]=this.words[r];t.length=this.length,t.negative=this.negative,t.red=this.red},c.prototype.clone=function(){var t=new c(null);return this.copy(t),t},c.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},c.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},c.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},c.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var gt=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],xt=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],yt=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];c.prototype.toString=function(t,r){t=t||10,r=r|0||1;var n;if(t===16||t==="hex"){n="";for(var s=0,f=0,d=0;d<this.length;d++){var m=this.words[d],o=((m<<s|f)&16777215).toString(16);f=m>>>24-s&16777215,f!==0||d!==this.length-1?n=gt[6-o.length]+o+n:n=o+n,s+=2,s>=26&&(s-=26,d--)}for(f!==0&&(n=f.toString(16)+n);n.length%r!==0;)n="0"+n;return this.negative!==0&&(n="-"+n),n}if(t===(t|0)&&t>=2&&t<=36){var e=xt[t],h=yt[t];n="";var _=this.clone();for(_.negative=0;!_.isZero();){var b=_.modn(h).toString(t);_=_.idivn(h),_.isZero()?n=b+n:n=gt[e-b.length]+b+n}for(this.isZero()&&(n="0"+n);n.length%r!==0;)n="0"+n;return this.negative!==0&&(n="-"+n),n}p(!1,"Base should be between 2 and 36")},c.prototype.toNumber=function(){var t=this.words[0];return this.length===2?t+=this.words[1]*67108864:this.length===3&&this.words[2]===1?t+=4503599627370496+this.words[1]*67108864:this.length>2&&p(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-t:t},c.prototype.toJSON=function(){return this.toString(16)},c.prototype.toBuffer=function(t,r){return p(typeof T<"u"),this.toArrayLike(T,t,r)},c.prototype.toArray=function(t,r){return this.toArrayLike(Array,t,r)},c.prototype.toArrayLike=function(t,r,n){var s=this.byteLength(),f=n||Math.max(1,s);p(s<=f,"byte array longer than desired length"),p(f>0,"Requested array length <= 0"),this.strip();var d=r==="le",m=new t(f),o,e,h=this.clone();if(d){for(e=0;!h.isZero();e++)o=h.andln(255),h.iushrn(8),m[e]=o;for(;e<f;e++)m[e]=0}else{for(e=0;e<f-s;e++)m[e]=0;for(e=0;!h.isZero();e++)o=h.andln(255),h.iushrn(8),m[f-e-1]=o}return m},Math.clz32?c.prototype._countBits=function(t){return 32-Math.clz32(t)}:c.prototype._countBits=function(t){var r=t,n=0;return r>=4096&&(n+=13,r>>>=13),r>=64&&(n+=7,r>>>=7),r>=8&&(n+=4,r>>>=4),r>=2&&(n+=2,r>>>=2),n+r},c.prototype._zeroBits=function(t){if(t===0)return 26;var r=t,n=0;return r&8191||(n+=13,r>>>=13),r&127||(n+=7,r>>>=7),r&15||(n+=4,r>>>=4),r&3||(n+=2,r>>>=2),r&1||n++,n},c.prototype.bitLength=function(){var t=this.words[this.length-1],r=this._countBits(t);return(this.length-1)*26+r};function _t(l){for(var t=new Array(l.bitLength()),r=0;r<t.length;r++){var n=r/26|0,s=r%26;t[r]=(l.words[n]&1<<s)>>>s}return t}c.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,r=0;r<this.length;r++){var n=this._zeroBits(this.words[r]);if(t+=n,n!==26)break}return t},c.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},c.prototype.toTwos=function(t){return this.negative!==0?this.abs().inotn(t).iaddn(1):this.clone()},c.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},c.prototype.isNeg=function(){return this.negative!==0},c.prototype.neg=function(){return this.clone().ineg()},c.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},c.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]|t.words[r];return this.strip()},c.prototype.ior=function(t){return p((this.negative|t.negative)===0),this.iuor(t)},c.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},c.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},c.prototype.iuand=function(t){var r;this.length>t.length?r=t:r=this;for(var n=0;n<r.length;n++)this.words[n]=this.words[n]&t.words[n];return this.length=r.length,this.strip()},c.prototype.iand=function(t){return p((this.negative|t.negative)===0),this.iuand(t)},c.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},c.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},c.prototype.iuxor=function(t){var r,n;this.length>t.length?(r=this,n=t):(r=t,n=this);for(var s=0;s<n.length;s++)this.words[s]=r.words[s]^n.words[s];if(this!==r)for(;s<r.length;s++)this.words[s]=r.words[s];return this.length=r.length,this.strip()},c.prototype.ixor=function(t){return p((this.negative|t.negative)===0),this.iuxor(t)},c.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},c.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},c.prototype.inotn=function(t){p(typeof t=="number"&&t>=0);var r=Math.ceil(t/26)|0,n=t%26;this._expand(r),n>0&&r--;for(var s=0;s<r;s++)this.words[s]=~this.words[s]&67108863;return n>0&&(this.words[s]=~this.words[s]&67108863>>26-n),this.strip()},c.prototype.notn=function(t){return this.clone().inotn(t)},c.prototype.setn=function(t,r){p(typeof t=="number"&&t>=0);var n=t/26|0,s=t%26;return this._expand(n+1),r?this.words[n]=this.words[n]|1<<s:this.words[n]=this.words[n]&~(1<<s),this.strip()},c.prototype.iadd=function(t){var r;if(this.negative!==0&&t.negative===0)return this.negative=0,r=this.isub(t),this.negative^=1,this._normSign();if(this.negative===0&&t.negative!==0)return t.negative=0,r=this.isub(t),t.negative=1,r._normSign();var n,s;this.length>t.length?(n=this,s=t):(n=t,s=this);for(var f=0,d=0;d<s.length;d++)r=(n.words[d]|0)+(s.words[d]|0)+f,this.words[d]=r&67108863,f=r>>>26;for(;f!==0&&d<n.length;d++)r=(n.words[d]|0)+f,this.words[d]=r&67108863,f=r>>>26;if(this.length=n.length,f!==0)this.words[this.length]=f,this.length++;else if(n!==this)for(;d<n.length;d++)this.words[d]=n.words[d];return this},c.prototype.add=function(t){var r;return t.negative!==0&&this.negative===0?(t.negative=0,r=this.sub(t),t.negative^=1,r):t.negative===0&&this.negative!==0?(this.negative=0,r=t.sub(this),this.negative=1,r):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},c.prototype.isub=function(t){if(t.negative!==0){t.negative=0;var r=this.iadd(t);return t.negative=1,r._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var n=this.cmp(t);if(n===0)return this.negative=0,this.length=1,this.words[0]=0,this;var s,f;n>0?(s=this,f=t):(s=t,f=this);for(var d=0,m=0;m<f.length;m++)r=(s.words[m]|0)-(f.words[m]|0)+d,d=r>>26,this.words[m]=r&67108863;for(;d!==0&&m<s.length;m++)r=(s.words[m]|0)+d,d=r>>26,this.words[m]=r&67108863;if(d===0&&m<s.length&&s!==this)for(;m<s.length;m++)this.words[m]=s.words[m];return this.length=Math.max(this.length,m),s!==this&&(this.negative=1),this.strip()},c.prototype.sub=function(t){return this.clone().isub(t)};function Mt(l,t,r){r.negative=t.negative^l.negative;var n=l.length+t.length|0;r.length=n,n=n-1|0;var s=l.words[0]|0,f=t.words[0]|0,d=s*f,m=d&67108863,o=d/67108864|0;r.words[0]=m;for(var e=1;e<n;e++){for(var h=o>>>26,_=o&67108863,b=Math.min(e,t.length-1),S=Math.max(0,e-l.length+1);S<=b;S++){var x=e-S|0;s=l.words[x]|0,f=t.words[S]|0,d=s*f+_,h+=d/67108864|0,_=d&67108863}r.words[e]=_|0,o=h|0}return o!==0?r.words[e]=o|0:r.length--,r.strip()}var It=function(t,r,n){var s=t.words,f=r.words,d=n.words,m=0,o,e,h,_=s[0]|0,b=_&8191,S=_>>>13,x=s[1]|0,E=x&8191,q=x>>>13,wt=s[2]|0,O=wt&8191,A=wt>>>13,me=s[3]|0,B=me&8191,L=me>>>13,ge=s[4]|0,U=ge&8191,P=ge>>>13,ve=s[5]|0,H=ve&8191,F=ve>>>13,Me=s[6]|0,$=Me&8191,Z=Me>>>13,ye=s[7]|0,j=ye&8191,J=ye>>>13,_e=s[8]|0,W=_e&8191,D=_e>>>13,we=s[9]|0,z=we&8191,K=we>>>13,be=f[0]|0,Q=be&8191,G=be>>>13,Se=f[1]|0,V=Se&8191,Y=Se>>>13,xe=f[2]|0,X=xe&8191,tt=xe>>>13,Re=f[3]|0,et=Re&8191,rt=Re>>>13,ke=f[4]|0,it=ke&8191,nt=ke>>>13,Ie=f[5]|0,st=Ie&8191,ot=Ie>>>13,Ee=f[6]|0,ht=Ee&8191,at=Ee>>>13,Te=f[7]|0,ft=Te&8191,ut=Te>>>13,qe=f[8]|0,ct=qe&8191,lt=qe>>>13,Oe=f[9]|0,dt=Oe&8191,pt=Oe>>>13;n.negative=t.negative^r.negative,n.length=19,o=Math.imul(b,Q),e=Math.imul(b,G),e=e+Math.imul(S,Q)|0,h=Math.imul(S,G);var Ft=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(Ft>>>26)|0,Ft&=67108863,o=Math.imul(E,Q),e=Math.imul(E,G),e=e+Math.imul(q,Q)|0,h=Math.imul(q,G),o=o+Math.imul(b,V)|0,e=e+Math.imul(b,Y)|0,e=e+Math.imul(S,V)|0,h=h+Math.imul(S,Y)|0;var $t=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+($t>>>26)|0,$t&=67108863,o=Math.imul(O,Q),e=Math.imul(O,G),e=e+Math.imul(A,Q)|0,h=Math.imul(A,G),o=o+Math.imul(E,V)|0,e=e+Math.imul(E,Y)|0,e=e+Math.imul(q,V)|0,h=h+Math.imul(q,Y)|0,o=o+Math.imul(b,X)|0,e=e+Math.imul(b,tt)|0,e=e+Math.imul(S,X)|0,h=h+Math.imul(S,tt)|0;var Zt=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(Zt>>>26)|0,Zt&=67108863,o=Math.imul(B,Q),e=Math.imul(B,G),e=e+Math.imul(L,Q)|0,h=Math.imul(L,G),o=o+Math.imul(O,V)|0,e=e+Math.imul(O,Y)|0,e=e+Math.imul(A,V)|0,h=h+Math.imul(A,Y)|0,o=o+Math.imul(E,X)|0,e=e+Math.imul(E,tt)|0,e=e+Math.imul(q,X)|0,h=h+Math.imul(q,tt)|0,o=o+Math.imul(b,et)|0,e=e+Math.imul(b,rt)|0,e=e+Math.imul(S,et)|0,h=h+Math.imul(S,rt)|0;var jt=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(jt>>>26)|0,jt&=67108863,o=Math.imul(U,Q),e=Math.imul(U,G),e=e+Math.imul(P,Q)|0,h=Math.imul(P,G),o=o+Math.imul(B,V)|0,e=e+Math.imul(B,Y)|0,e=e+Math.imul(L,V)|0,h=h+Math.imul(L,Y)|0,o=o+Math.imul(O,X)|0,e=e+Math.imul(O,tt)|0,e=e+Math.imul(A,X)|0,h=h+Math.imul(A,tt)|0,o=o+Math.imul(E,et)|0,e=e+Math.imul(E,rt)|0,e=e+Math.imul(q,et)|0,h=h+Math.imul(q,rt)|0,o=o+Math.imul(b,it)|0,e=e+Math.imul(b,nt)|0,e=e+Math.imul(S,it)|0,h=h+Math.imul(S,nt)|0;var Jt=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(Jt>>>26)|0,Jt&=67108863,o=Math.imul(H,Q),e=Math.imul(H,G),e=e+Math.imul(F,Q)|0,h=Math.imul(F,G),o=o+Math.imul(U,V)|0,e=e+Math.imul(U,Y)|0,e=e+Math.imul(P,V)|0,h=h+Math.imul(P,Y)|0,o=o+Math.imul(B,X)|0,e=e+Math.imul(B,tt)|0,e=e+Math.imul(L,X)|0,h=h+Math.imul(L,tt)|0,o=o+Math.imul(O,et)|0,e=e+Math.imul(O,rt)|0,e=e+Math.imul(A,et)|0,h=h+Math.imul(A,rt)|0,o=o+Math.imul(E,it)|0,e=e+Math.imul(E,nt)|0,e=e+Math.imul(q,it)|0,h=h+Math.imul(q,nt)|0,o=o+Math.imul(b,st)|0,e=e+Math.imul(b,ot)|0,e=e+Math.imul(S,st)|0,h=h+Math.imul(S,ot)|0;var Wt=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(Wt>>>26)|0,Wt&=67108863,o=Math.imul($,Q),e=Math.imul($,G),e=e+Math.imul(Z,Q)|0,h=Math.imul(Z,G),o=o+Math.imul(H,V)|0,e=e+Math.imul(H,Y)|0,e=e+Math.imul(F,V)|0,h=h+Math.imul(F,Y)|0,o=o+Math.imul(U,X)|0,e=e+Math.imul(U,tt)|0,e=e+Math.imul(P,X)|0,h=h+Math.imul(P,tt)|0,o=o+Math.imul(B,et)|0,e=e+Math.imul(B,rt)|0,e=e+Math.imul(L,et)|0,h=h+Math.imul(L,rt)|0,o=o+Math.imul(O,it)|0,e=e+Math.imul(O,nt)|0,e=e+Math.imul(A,it)|0,h=h+Math.imul(A,nt)|0,o=o+Math.imul(E,st)|0,e=e+Math.imul(E,ot)|0,e=e+Math.imul(q,st)|0,h=h+Math.imul(q,ot)|0,o=o+Math.imul(b,ht)|0,e=e+Math.imul(b,at)|0,e=e+Math.imul(S,ht)|0,h=h+Math.imul(S,at)|0;var Dt=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(Dt>>>26)|0,Dt&=67108863,o=Math.imul(j,Q),e=Math.imul(j,G),e=e+Math.imul(J,Q)|0,h=Math.imul(J,G),o=o+Math.imul($,V)|0,e=e+Math.imul($,Y)|0,e=e+Math.imul(Z,V)|0,h=h+Math.imul(Z,Y)|0,o=o+Math.imul(H,X)|0,e=e+Math.imul(H,tt)|0,e=e+Math.imul(F,X)|0,h=h+Math.imul(F,tt)|0,o=o+Math.imul(U,et)|0,e=e+Math.imul(U,rt)|0,e=e+Math.imul(P,et)|0,h=h+Math.imul(P,rt)|0,o=o+Math.imul(B,it)|0,e=e+Math.imul(B,nt)|0,e=e+Math.imul(L,it)|0,h=h+Math.imul(L,nt)|0,o=o+Math.imul(O,st)|0,e=e+Math.imul(O,ot)|0,e=e+Math.imul(A,st)|0,h=h+Math.imul(A,ot)|0,o=o+Math.imul(E,ht)|0,e=e+Math.imul(E,at)|0,e=e+Math.imul(q,ht)|0,h=h+Math.imul(q,at)|0,o=o+Math.imul(b,ft)|0,e=e+Math.imul(b,ut)|0,e=e+Math.imul(S,ft)|0,h=h+Math.imul(S,ut)|0;var zt=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(zt>>>26)|0,zt&=67108863,o=Math.imul(W,Q),e=Math.imul(W,G),e=e+Math.imul(D,Q)|0,h=Math.imul(D,G),o=o+Math.imul(j,V)|0,e=e+Math.imul(j,Y)|0,e=e+Math.imul(J,V)|0,h=h+Math.imul(J,Y)|0,o=o+Math.imul($,X)|0,e=e+Math.imul($,tt)|0,e=e+Math.imul(Z,X)|0,h=h+Math.imul(Z,tt)|0,o=o+Math.imul(H,et)|0,e=e+Math.imul(H,rt)|0,e=e+Math.imul(F,et)|0,h=h+Math.imul(F,rt)|0,o=o+Math.imul(U,it)|0,e=e+Math.imul(U,nt)|0,e=e+Math.imul(P,it)|0,h=h+Math.imul(P,nt)|0,o=o+Math.imul(B,st)|0,e=e+Math.imul(B,ot)|0,e=e+Math.imul(L,st)|0,h=h+Math.imul(L,ot)|0,o=o+Math.imul(O,ht)|0,e=e+Math.imul(O,at)|0,e=e+Math.imul(A,ht)|0,h=h+Math.imul(A,at)|0,o=o+Math.imul(E,ft)|0,e=e+Math.imul(E,ut)|0,e=e+Math.imul(q,ft)|0,h=h+Math.imul(q,ut)|0,o=o+Math.imul(b,ct)|0,e=e+Math.imul(b,lt)|0,e=e+Math.imul(S,ct)|0,h=h+Math.imul(S,lt)|0;var Kt=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(Kt>>>26)|0,Kt&=67108863,o=Math.imul(z,Q),e=Math.imul(z,G),e=e+Math.imul(K,Q)|0,h=Math.imul(K,G),o=o+Math.imul(W,V)|0,e=e+Math.imul(W,Y)|0,e=e+Math.imul(D,V)|0,h=h+Math.imul(D,Y)|0,o=o+Math.imul(j,X)|0,e=e+Math.imul(j,tt)|0,e=e+Math.imul(J,X)|0,h=h+Math.imul(J,tt)|0,o=o+Math.imul($,et)|0,e=e+Math.imul($,rt)|0,e=e+Math.imul(Z,et)|0,h=h+Math.imul(Z,rt)|0,o=o+Math.imul(H,it)|0,e=e+Math.imul(H,nt)|0,e=e+Math.imul(F,it)|0,h=h+Math.imul(F,nt)|0,o=o+Math.imul(U,st)|0,e=e+Math.imul(U,ot)|0,e=e+Math.imul(P,st)|0,h=h+Math.imul(P,ot)|0,o=o+Math.imul(B,ht)|0,e=e+Math.imul(B,at)|0,e=e+Math.imul(L,ht)|0,h=h+Math.imul(L,at)|0,o=o+Math.imul(O,ft)|0,e=e+Math.imul(O,ut)|0,e=e+Math.imul(A,ft)|0,h=h+Math.imul(A,ut)|0,o=o+Math.imul(E,ct)|0,e=e+Math.imul(E,lt)|0,e=e+Math.imul(q,ct)|0,h=h+Math.imul(q,lt)|0,o=o+Math.imul(b,dt)|0,e=e+Math.imul(b,pt)|0,e=e+Math.imul(S,dt)|0,h=h+Math.imul(S,pt)|0;var Qt=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(Qt>>>26)|0,Qt&=67108863,o=Math.imul(z,V),e=Math.imul(z,Y),e=e+Math.imul(K,V)|0,h=Math.imul(K,Y),o=o+Math.imul(W,X)|0,e=e+Math.imul(W,tt)|0,e=e+Math.imul(D,X)|0,h=h+Math.imul(D,tt)|0,o=o+Math.imul(j,et)|0,e=e+Math.imul(j,rt)|0,e=e+Math.imul(J,et)|0,h=h+Math.imul(J,rt)|0,o=o+Math.imul($,it)|0,e=e+Math.imul($,nt)|0,e=e+Math.imul(Z,it)|0,h=h+Math.imul(Z,nt)|0,o=o+Math.imul(H,st)|0,e=e+Math.imul(H,ot)|0,e=e+Math.imul(F,st)|0,h=h+Math.imul(F,ot)|0,o=o+Math.imul(U,ht)|0,e=e+Math.imul(U,at)|0,e=e+Math.imul(P,ht)|0,h=h+Math.imul(P,at)|0,o=o+Math.imul(B,ft)|0,e=e+Math.imul(B,ut)|0,e=e+Math.imul(L,ft)|0,h=h+Math.imul(L,ut)|0,o=o+Math.imul(O,ct)|0,e=e+Math.imul(O,lt)|0,e=e+Math.imul(A,ct)|0,h=h+Math.imul(A,lt)|0,o=o+Math.imul(E,dt)|0,e=e+Math.imul(E,pt)|0,e=e+Math.imul(q,dt)|0,h=h+Math.imul(q,pt)|0;var Gt=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(Gt>>>26)|0,Gt&=67108863,o=Math.imul(z,X),e=Math.imul(z,tt),e=e+Math.imul(K,X)|0,h=Math.imul(K,tt),o=o+Math.imul(W,et)|0,e=e+Math.imul(W,rt)|0,e=e+Math.imul(D,et)|0,h=h+Math.imul(D,rt)|0,o=o+Math.imul(j,it)|0,e=e+Math.imul(j,nt)|0,e=e+Math.imul(J,it)|0,h=h+Math.imul(J,nt)|0,o=o+Math.imul($,st)|0,e=e+Math.imul($,ot)|0,e=e+Math.imul(Z,st)|0,h=h+Math.imul(Z,ot)|0,o=o+Math.imul(H,ht)|0,e=e+Math.imul(H,at)|0,e=e+Math.imul(F,ht)|0,h=h+Math.imul(F,at)|0,o=o+Math.imul(U,ft)|0,e=e+Math.imul(U,ut)|0,e=e+Math.imul(P,ft)|0,h=h+Math.imul(P,ut)|0,o=o+Math.imul(B,ct)|0,e=e+Math.imul(B,lt)|0,e=e+Math.imul(L,ct)|0,h=h+Math.imul(L,lt)|0,o=o+Math.imul(O,dt)|0,e=e+Math.imul(O,pt)|0,e=e+Math.imul(A,dt)|0,h=h+Math.imul(A,pt)|0;var Vt=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(Vt>>>26)|0,Vt&=67108863,o=Math.imul(z,et),e=Math.imul(z,rt),e=e+Math.imul(K,et)|0,h=Math.imul(K,rt),o=o+Math.imul(W,it)|0,e=e+Math.imul(W,nt)|0,e=e+Math.imul(D,it)|0,h=h+Math.imul(D,nt)|0,o=o+Math.imul(j,st)|0,e=e+Math.imul(j,ot)|0,e=e+Math.imul(J,st)|0,h=h+Math.imul(J,ot)|0,o=o+Math.imul($,ht)|0,e=e+Math.imul($,at)|0,e=e+Math.imul(Z,ht)|0,h=h+Math.imul(Z,at)|0,o=o+Math.imul(H,ft)|0,e=e+Math.imul(H,ut)|0,e=e+Math.imul(F,ft)|0,h=h+Math.imul(F,ut)|0,o=o+Math.imul(U,ct)|0,e=e+Math.imul(U,lt)|0,e=e+Math.imul(P,ct)|0,h=h+Math.imul(P,lt)|0,o=o+Math.imul(B,dt)|0,e=e+Math.imul(B,pt)|0,e=e+Math.imul(L,dt)|0,h=h+Math.imul(L,pt)|0;var Yt=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(Yt>>>26)|0,Yt&=67108863,o=Math.imul(z,it),e=Math.imul(z,nt),e=e+Math.imul(K,it)|0,h=Math.imul(K,nt),o=o+Math.imul(W,st)|0,e=e+Math.imul(W,ot)|0,e=e+Math.imul(D,st)|0,h=h+Math.imul(D,ot)|0,o=o+Math.imul(j,ht)|0,e=e+Math.imul(j,at)|0,e=e+Math.imul(J,ht)|0,h=h+Math.imul(J,at)|0,o=o+Math.imul($,ft)|0,e=e+Math.imul($,ut)|0,e=e+Math.imul(Z,ft)|0,h=h+Math.imul(Z,ut)|0,o=o+Math.imul(H,ct)|0,e=e+Math.imul(H,lt)|0,e=e+Math.imul(F,ct)|0,h=h+Math.imul(F,lt)|0,o=o+Math.imul(U,dt)|0,e=e+Math.imul(U,pt)|0,e=e+Math.imul(P,dt)|0,h=h+Math.imul(P,pt)|0;var Xt=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(Xt>>>26)|0,Xt&=67108863,o=Math.imul(z,st),e=Math.imul(z,ot),e=e+Math.imul(K,st)|0,h=Math.imul(K,ot),o=o+Math.imul(W,ht)|0,e=e+Math.imul(W,at)|0,e=e+Math.imul(D,ht)|0,h=h+Math.imul(D,at)|0,o=o+Math.imul(j,ft)|0,e=e+Math.imul(j,ut)|0,e=e+Math.imul(J,ft)|0,h=h+Math.imul(J,ut)|0,o=o+Math.imul($,ct)|0,e=e+Math.imul($,lt)|0,e=e+Math.imul(Z,ct)|0,h=h+Math.imul(Z,lt)|0,o=o+Math.imul(H,dt)|0,e=e+Math.imul(H,pt)|0,e=e+Math.imul(F,dt)|0,h=h+Math.imul(F,pt)|0;var te=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(te>>>26)|0,te&=67108863,o=Math.imul(z,ht),e=Math.imul(z,at),e=e+Math.imul(K,ht)|0,h=Math.imul(K,at),o=o+Math.imul(W,ft)|0,e=e+Math.imul(W,ut)|0,e=e+Math.imul(D,ft)|0,h=h+Math.imul(D,ut)|0,o=o+Math.imul(j,ct)|0,e=e+Math.imul(j,lt)|0,e=e+Math.imul(J,ct)|0,h=h+Math.imul(J,lt)|0,o=o+Math.imul($,dt)|0,e=e+Math.imul($,pt)|0,e=e+Math.imul(Z,dt)|0,h=h+Math.imul(Z,pt)|0;var ee=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(ee>>>26)|0,ee&=67108863,o=Math.imul(z,ft),e=Math.imul(z,ut),e=e+Math.imul(K,ft)|0,h=Math.imul(K,ut),o=o+Math.imul(W,ct)|0,e=e+Math.imul(W,lt)|0,e=e+Math.imul(D,ct)|0,h=h+Math.imul(D,lt)|0,o=o+Math.imul(j,dt)|0,e=e+Math.imul(j,pt)|0,e=e+Math.imul(J,dt)|0,h=h+Math.imul(J,pt)|0;var re=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(re>>>26)|0,re&=67108863,o=Math.imul(z,ct),e=Math.imul(z,lt),e=e+Math.imul(K,ct)|0,h=Math.imul(K,lt),o=o+Math.imul(W,dt)|0,e=e+Math.imul(W,pt)|0,e=e+Math.imul(D,dt)|0,h=h+Math.imul(D,pt)|0;var ie=(m+o|0)+((e&8191)<<13)|0;m=(h+(e>>>13)|0)+(ie>>>26)|0,ie&=67108863,o=Math.imul(z,dt),e=Math.imul(z,pt),e=e+Math.imul(K,dt)|0,h=Math.imul(K,pt);var ne=(m+o|0)+((e&8191)<<13)|0;return m=(h+(e>>>13)|0)+(ne>>>26)|0,ne&=67108863,d[0]=Ft,d[1]=$t,d[2]=Zt,d[3]=jt,d[4]=Jt,d[5]=Wt,d[6]=Dt,d[7]=zt,d[8]=Kt,d[9]=Qt,d[10]=Gt,d[11]=Vt,d[12]=Yt,d[13]=Xt,d[14]=te,d[15]=ee,d[16]=re,d[17]=ie,d[18]=ne,m!==0&&(d[19]=m,n.length++),n};Math.imul||(It=Mt);function Nt(l,t,r){r.negative=t.negative^l.negative,r.length=l.length+t.length;for(var n=0,s=0,f=0;f<r.length-1;f++){var d=s;s=0;for(var m=n&67108863,o=Math.min(f,t.length-1),e=Math.max(0,f-l.length+1);e<=o;e++){var h=f-e,_=l.words[h]|0,b=t.words[e]|0,S=_*b,x=S&67108863;d=d+(S/67108864|0)|0,x=x+m|0,m=x&67108863,d=d+(x>>>26)|0,s+=d>>>26,d&=67108863}r.words[f]=m,n=d,d=s}return n!==0?r.words[f]=n:r.length--,r.strip()}function g(l,t,r){var n=new M;return n.mulp(l,t,r)}c.prototype.mulTo=function(t,r){var n,s=this.length+t.length;return this.length===10&&t.length===10?n=It(this,t,r):s<63?n=Mt(this,t,r):s<1024?n=Nt(this,t,r):n=g(this,t,r),n};function M(l,t){this.x=l,this.y=t}M.prototype.makeRBT=function(t){for(var r=new Array(t),n=c.prototype._countBits(t)-1,s=0;s<t;s++)r[s]=this.revBin(s,n,t);return r},M.prototype.revBin=function(t,r,n){if(t===0||t===n-1)return t;for(var s=0,f=0;f<r;f++)s|=(t&1)<<r-f-1,t>>=1;return s},M.prototype.permute=function(t,r,n,s,f,d){for(var m=0;m<d;m++)s[m]=r[t[m]],f[m]=n[t[m]]},M.prototype.transform=function(t,r,n,s,f,d){this.permute(d,t,r,n,s,f);for(var m=1;m<f;m<<=1)for(var o=m<<1,e=Math.cos(2*Math.PI/o),h=Math.sin(2*Math.PI/o),_=0;_<f;_+=o)for(var b=e,S=h,x=0;x<m;x++){var E=n[_+x],q=s[_+x],wt=n[_+x+m],O=s[_+x+m],A=b*wt-S*O;O=b*O+S*wt,wt=A,n[_+x]=E+wt,s[_+x]=q+O,n[_+x+m]=E-wt,s[_+x+m]=q-O,x!==o&&(A=e*b-h*S,S=e*S+h*b,b=A)}},M.prototype.guessLen13b=function(t,r){var n=Math.max(r,t)|1,s=n&1,f=0;for(n=n/2|0;n;n=n>>>1)f++;return 1<<f+1+s},M.prototype.conjugate=function(t,r,n){if(!(n<=1))for(var s=0;s<n/2;s++){var f=t[s];t[s]=t[n-s-1],t[n-s-1]=f,f=r[s],r[s]=-r[n-s-1],r[n-s-1]=-f}},M.prototype.normalize13b=function(t,r){for(var n=0,s=0;s<r/2;s++){var f=Math.round(t[2*s+1]/r)*8192+Math.round(t[2*s]/r)+n;t[s]=f&67108863,f<67108864?n=0:n=f/67108864|0}return t},M.prototype.convert13b=function(t,r,n,s){for(var f=0,d=0;d<r;d++)f=f+(t[d]|0),n[2*d]=f&8191,f=f>>>13,n[2*d+1]=f&8191,f=f>>>13;for(d=2*r;d<s;++d)n[d]=0;p(f===0),p((f&-8192)===0)},M.prototype.stub=function(t){for(var r=new Array(t),n=0;n<t;n++)r[n]=0;return r},M.prototype.mulp=function(t,r,n){var s=2*this.guessLen13b(t.length,r.length),f=this.makeRBT(s),d=this.stub(s),m=new Array(s),o=new Array(s),e=new Array(s),h=new Array(s),_=new Array(s),b=new Array(s),S=n.words;S.length=s,this.convert13b(t.words,t.length,m,s),this.convert13b(r.words,r.length,h,s),this.transform(m,d,o,e,s,f),this.transform(h,d,_,b,s,f);for(var x=0;x<s;x++){var E=o[x]*_[x]-e[x]*b[x];e[x]=o[x]*b[x]+e[x]*_[x],o[x]=E}return this.conjugate(o,e,s),this.transform(o,e,S,d,s,f),this.conjugate(S,d,s),this.normalize13b(S,s),n.negative=t.negative^r.negative,n.length=t.length+r.length,n.strip()},c.prototype.mul=function(t){var r=new c(null);return r.words=new Array(this.length+t.length),this.mulTo(t,r)},c.prototype.mulf=function(t){var r=new c(null);return r.words=new Array(this.length+t.length),g(this,t,r)},c.prototype.imul=function(t){return this.clone().mulTo(t,this)},c.prototype.imuln=function(t){p(typeof t=="number"),p(t<67108864);for(var r=0,n=0;n<this.length;n++){var s=(this.words[n]|0)*t,f=(s&67108863)+(r&67108863);r>>=26,r+=s/67108864|0,r+=f>>>26,this.words[n]=f&67108863}return r!==0&&(this.words[n]=r,this.length++),this},c.prototype.muln=function(t){return this.clone().imuln(t)},c.prototype.sqr=function(){return this.mul(this)},c.prototype.isqr=function(){return this.imul(this.clone())},c.prototype.pow=function(t){var r=_t(t);if(r.length===0)return new c(1);for(var n=this,s=0;s<r.length&&r[s]===0;s++,n=n.sqr());if(++s<r.length)for(var f=n.sqr();s<r.length;s++,f=f.sqr())r[s]!==0&&(n=n.mul(f));return n},c.prototype.iushln=function(t){p(typeof t=="number"&&t>=0);var r=t%26,n=(t-r)/26,s=67108863>>>26-r<<26-r,f;if(r!==0){var d=0;for(f=0;f<this.length;f++){var m=this.words[f]&s,o=(this.words[f]|0)-m<<r;this.words[f]=o|d,d=m>>>26-r}d&&(this.words[f]=d,this.length++)}if(n!==0){for(f=this.length-1;f>=0;f--)this.words[f+n]=this.words[f];for(f=0;f<n;f++)this.words[f]=0;this.length+=n}return this.strip()},c.prototype.ishln=function(t){return p(this.negative===0),this.iushln(t)},c.prototype.iushrn=function(t,r,n){p(typeof t=="number"&&t>=0);var s;r?s=(r-r%26)/26:s=0;var f=t%26,d=Math.min((t-f)/26,this.length),m=67108863^67108863>>>f<<f,o=n;if(s-=d,s=Math.max(0,s),o){for(var e=0;e<d;e++)o.words[e]=this.words[e];o.length=d}if(d!==0)if(this.length>d)for(this.length-=d,e=0;e<this.length;e++)this.words[e]=this.words[e+d];else this.words[0]=0,this.length=1;var h=0;for(e=this.length-1;e>=0&&(h!==0||e>=s);e--){var _=this.words[e]|0;this.words[e]=h<<26-f|_>>>f,h=_&m}return o&&h!==0&&(o.words[o.length++]=h),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},c.prototype.ishrn=function(t,r,n){return p(this.negative===0),this.iushrn(t,r,n)},c.prototype.shln=function(t){return this.clone().ishln(t)},c.prototype.ushln=function(t){return this.clone().iushln(t)},c.prototype.shrn=function(t){return this.clone().ishrn(t)},c.prototype.ushrn=function(t){return this.clone().iushrn(t)},c.prototype.testn=function(t){p(typeof t=="number"&&t>=0);var r=t%26,n=(t-r)/26,s=1<<r;if(this.length<=n)return!1;var f=this.words[n];return!!(f&s)},c.prototype.imaskn=function(t){p(typeof t=="number"&&t>=0);var r=t%26,n=(t-r)/26;if(p(this.negative===0,"imaskn works only with positive numbers"),this.length<=n)return this;if(r!==0&&n++,this.length=Math.min(n,this.length),r!==0){var s=67108863^67108863>>>r<<r;this.words[this.length-1]&=s}return this.strip()},c.prototype.maskn=function(t){return this.clone().imaskn(t)},c.prototype.iaddn=function(t){return p(typeof t=="number"),p(t<67108864),t<0?this.isubn(-t):this.negative!==0?this.length===1&&(this.words[0]|0)<t?(this.words[0]=t-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},c.prototype._iaddn=function(t){this.words[0]+=t;for(var r=0;r<this.length&&this.words[r]>=67108864;r++)this.words[r]-=67108864,r===this.length-1?this.words[r+1]=1:this.words[r+1]++;return this.length=Math.max(this.length,r+1),this},c.prototype.isubn=function(t){if(p(typeof t=="number"),p(t<67108864),t<0)return this.iaddn(-t);if(this.negative!==0)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var r=0;r<this.length&&this.words[r]<0;r++)this.words[r]+=67108864,this.words[r+1]-=1;return this.strip()},c.prototype.addn=function(t){return this.clone().iaddn(t)},c.prototype.subn=function(t){return this.clone().isubn(t)},c.prototype.iabs=function(){return this.negative=0,this},c.prototype.abs=function(){return this.clone().iabs()},c.prototype._ishlnsubmul=function(t,r,n){var s=t.length+n,f;this._expand(s);var d,m=0;for(f=0;f<t.length;f++){d=(this.words[f+n]|0)+m;var o=(t.words[f]|0)*r;d-=o&67108863,m=(d>>26)-(o/67108864|0),this.words[f+n]=d&67108863}for(;f<this.length-n;f++)d=(this.words[f+n]|0)+m,m=d>>26,this.words[f+n]=d&67108863;if(m===0)return this.strip();for(p(m===-1),m=0,f=0;f<this.length;f++)d=-(this.words[f]|0)+m,m=d>>26,this.words[f]=d&67108863;return this.negative=1,this.strip()},c.prototype._wordDiv=function(t,r){var n=this.length-t.length,s=this.clone(),f=t,d=f.words[f.length-1]|0,m=this._countBits(d);n=26-m,n!==0&&(f=f.ushln(n),s.iushln(n),d=f.words[f.length-1]|0);var o=s.length-f.length,e;if(r!=="mod"){e=new c(null),e.length=o+1,e.words=new Array(e.length);for(var h=0;h<e.length;h++)e.words[h]=0}var _=s.clone()._ishlnsubmul(f,1,o);_.negative===0&&(s=_,e&&(e.words[o]=1));for(var b=o-1;b>=0;b--){var S=(s.words[f.length+b]|0)*67108864+(s.words[f.length+b-1]|0);for(S=Math.min(S/d|0,67108863),s._ishlnsubmul(f,S,b);s.negative!==0;)S--,s.negative=0,s._ishlnsubmul(f,1,b),s.isZero()||(s.negative^=1);e&&(e.words[b]=S)}return e&&e.strip(),s.strip(),r!=="div"&&n!==0&&s.iushrn(n),{div:e||null,mod:s}},c.prototype.divmod=function(t,r,n){if(p(!t.isZero()),this.isZero())return{div:new c(0),mod:new c(0)};var s,f,d;return this.negative!==0&&t.negative===0?(d=this.neg().divmod(t,r),r!=="mod"&&(s=d.div.neg()),r!=="div"&&(f=d.mod.neg(),n&&f.negative!==0&&f.iadd(t)),{div:s,mod:f}):this.negative===0&&t.negative!==0?(d=this.divmod(t.neg(),r),r!=="mod"&&(s=d.div.neg()),{div:s,mod:d.mod}):this.negative&t.negative?(d=this.neg().divmod(t.neg(),r),r!=="div"&&(f=d.mod.neg(),n&&f.negative!==0&&f.isub(t)),{div:d.div,mod:f}):t.length>this.length||this.cmp(t)<0?{div:new c(0),mod:this}:t.length===1?r==="div"?{div:this.divn(t.words[0]),mod:null}:r==="mod"?{div:null,mod:new c(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new c(this.modn(t.words[0]))}:this._wordDiv(t,r)},c.prototype.div=function(t){return this.divmod(t,"div",!1).div},c.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},c.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},c.prototype.divRound=function(t){var r=this.divmod(t);if(r.mod.isZero())return r.div;var n=r.div.negative!==0?r.mod.isub(t):r.mod,s=t.ushrn(1),f=t.andln(1),d=n.cmp(s);return d<0||f===1&&d===0?r.div:r.div.negative!==0?r.div.isubn(1):r.div.iaddn(1)},c.prototype.modn=function(t){p(t<=67108863);for(var r=(1<<26)%t,n=0,s=this.length-1;s>=0;s--)n=(r*n+(this.words[s]|0))%t;return n},c.prototype.idivn=function(t){p(t<=67108863);for(var r=0,n=this.length-1;n>=0;n--){var s=(this.words[n]|0)+r*67108864;this.words[n]=s/t|0,r=s%t}return this.strip()},c.prototype.divn=function(t){return this.clone().idivn(t)},c.prototype.egcd=function(t){p(t.negative===0),p(!t.isZero());var r=this,n=t.clone();r.negative!==0?r=r.umod(t):r=r.clone();for(var s=new c(1),f=new c(0),d=new c(0),m=new c(1),o=0;r.isEven()&&n.isEven();)r.iushrn(1),n.iushrn(1),++o;for(var e=n.clone(),h=r.clone();!r.isZero();){for(var _=0,b=1;!(r.words[0]&b)&&_<26;++_,b<<=1);if(_>0)for(r.iushrn(_);_-- >0;)(s.isOdd()||f.isOdd())&&(s.iadd(e),f.isub(h)),s.iushrn(1),f.iushrn(1);for(var S=0,x=1;!(n.words[0]&x)&&S<26;++S,x<<=1);if(S>0)for(n.iushrn(S);S-- >0;)(d.isOdd()||m.isOdd())&&(d.iadd(e),m.isub(h)),d.iushrn(1),m.iushrn(1);r.cmp(n)>=0?(r.isub(n),s.isub(d),f.isub(m)):(n.isub(r),d.isub(s),m.isub(f))}return{a:d,b:m,gcd:n.iushln(o)}},c.prototype._invmp=function(t){p(t.negative===0),p(!t.isZero());var r=this,n=t.clone();r.negative!==0?r=r.umod(t):r=r.clone();for(var s=new c(1),f=new c(0),d=n.clone();r.cmpn(1)>0&&n.cmpn(1)>0;){for(var m=0,o=1;!(r.words[0]&o)&&m<26;++m,o<<=1);if(m>0)for(r.iushrn(m);m-- >0;)s.isOdd()&&s.iadd(d),s.iushrn(1);for(var e=0,h=1;!(n.words[0]&h)&&e<26;++e,h<<=1);if(e>0)for(n.iushrn(e);e-- >0;)f.isOdd()&&f.iadd(d),f.iushrn(1);r.cmp(n)>=0?(r.isub(n),s.isub(f)):(n.isub(r),f.isub(s))}var _;return r.cmpn(1)===0?_=s:_=f,_.cmpn(0)<0&&_.iadd(t),_},c.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var r=this.clone(),n=t.clone();r.negative=0,n.negative=0;for(var s=0;r.isEven()&&n.isEven();s++)r.iushrn(1),n.iushrn(1);do{for(;r.isEven();)r.iushrn(1);for(;n.isEven();)n.iushrn(1);var f=r.cmp(n);if(f<0){var d=r;r=n,n=d}else if(f===0||n.cmpn(1)===0)break;r.isub(n)}while(!0);return n.iushln(s)},c.prototype.invm=function(t){return this.egcd(t).a.umod(t)},c.prototype.isEven=function(){return(this.words[0]&1)===0},c.prototype.isOdd=function(){return(this.words[0]&1)===1},c.prototype.andln=function(t){return this.words[0]&t},c.prototype.bincn=function(t){p(typeof t=="number");var r=t%26,n=(t-r)/26,s=1<<r;if(this.length<=n)return this._expand(n+1),this.words[n]|=s,this;for(var f=s,d=n;f!==0&&d<this.length;d++){var m=this.words[d]|0;m+=f,f=m>>>26,m&=67108863,this.words[d]=m}return f!==0&&(this.words[d]=f,this.length++),this},c.prototype.isZero=function(){return this.length===1&&this.words[0]===0},c.prototype.cmpn=function(t){var r=t<0;if(this.negative!==0&&!r)return-1;if(this.negative===0&&r)return 1;this.strip();var n;if(this.length>1)n=1;else{r&&(t=-t),p(t<=67108863,"Number is too big");var s=this.words[0]|0;n=s===t?0:s<t?-1:1}return this.negative!==0?-n|0:n},c.prototype.cmp=function(t){if(this.negative!==0&&t.negative===0)return-1;if(this.negative===0&&t.negative!==0)return 1;var r=this.ucmp(t);return this.negative!==0?-r|0:r},c.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var r=0,n=this.length-1;n>=0;n--){var s=this.words[n]|0,f=t.words[n]|0;if(s!==f){s<f?r=-1:s>f&&(r=1);break}}return r},c.prototype.gtn=function(t){return this.cmpn(t)===1},c.prototype.gt=function(t){return this.cmp(t)===1},c.prototype.gten=function(t){return this.cmpn(t)>=0},c.prototype.gte=function(t){return this.cmp(t)>=0},c.prototype.ltn=function(t){return this.cmpn(t)===-1},c.prototype.lt=function(t){return this.cmp(t)===-1},c.prototype.lten=function(t){return this.cmpn(t)<=0},c.prototype.lte=function(t){return this.cmp(t)<=0},c.prototype.eqn=function(t){return this.cmpn(t)===0},c.prototype.eq=function(t){return this.cmp(t)===0},c.red=function(t){return new N(t)},c.prototype.toRed=function(t){return p(!this.red,"Already a number in reduction context"),p(this.negative===0,"red works only with positives"),t.convertTo(this)._forceRed(t)},c.prototype.fromRed=function(){return p(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},c.prototype._forceRed=function(t){return this.red=t,this},c.prototype.forceRed=function(t){return p(!this.red,"Already a number in reduction context"),this._forceRed(t)},c.prototype.redAdd=function(t){return p(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},c.prototype.redIAdd=function(t){return p(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},c.prototype.redSub=function(t){return p(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},c.prototype.redISub=function(t){return p(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},c.prototype.redShl=function(t){return p(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},c.prototype.redMul=function(t){return p(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},c.prototype.redIMul=function(t){return p(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},c.prototype.redSqr=function(){return p(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},c.prototype.redISqr=function(){return p(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},c.prototype.redSqrt=function(){return p(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},c.prototype.redInvm=function(){return p(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},c.prototype.redNeg=function(){return p(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},c.prototype.redPow=function(t){return p(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var w={k256:null,p224:null,p192:null,p25519:null};function y(l,t){this.name=l,this.p=new c(t,16),this.n=this.p.bitLength(),this.k=new c(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}y.prototype._tmp=function(){var t=new c(null);return t.words=new Array(Math.ceil(this.n/13)),t},y.prototype.ireduce=function(t){var r=t,n;do this.split(r,this.tmp),r=this.imulK(r),r=r.iadd(this.tmp),n=r.bitLength();while(n>this.n);var s=n<this.n?-1:r.ucmp(this.p);return s===0?(r.words[0]=0,r.length=1):s>0?r.isub(this.p):r.strip(),r},y.prototype.split=function(t,r){t.iushrn(this.n,0,r)},y.prototype.imulK=function(t){return t.imul(this.k)};function R(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}v(R,y),R.prototype.split=function(t,r){for(var n=4194303,s=Math.min(t.length,9),f=0;f<s;f++)r.words[f]=t.words[f];if(r.length=s,t.length<=9){t.words[0]=0,t.length=1;return}var d=t.words[9];for(r.words[r.length++]=d&n,f=10;f<t.length;f++){var m=t.words[f]|0;t.words[f-10]=(m&n)<<4|d>>>22,d=m}d>>>=22,t.words[f-10]=d,d===0&&t.length>10?t.length-=10:t.length-=9},R.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var r=0,n=0;n<t.length;n++){var s=t.words[n]|0;r+=s*977,t.words[n]=r&67108863,r=s*64+(r/67108864|0)}return t.words[t.length-1]===0&&(t.length--,t.words[t.length-1]===0&&t.length--),t};function C(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}v(C,y);function k(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}v(k,y);function vt(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}v(vt,y),vt.prototype.imulK=function(t){for(var r=0,n=0;n<t.length;n++){var s=(t.words[n]|0)*19+r,f=s&67108863;s>>>=26,t.words[n]=f,r=s}return r!==0&&(t.words[t.length++]=r),t},c._prime=function(t){if(w[t])return w[t];var r;if(t==="k256")r=new R;else if(t==="p224")r=new C;else if(t==="p192")r=new k;else if(t==="p25519")r=new vt;else throw new Error("Unknown prime "+t);return w[t]=r,r};function N(l){if(typeof l=="string"){var t=c._prime(l);this.m=t.p,this.prime=t}else p(l.gtn(1),"modulus must be greater than 1"),this.m=l,this.prime=null}N.prototype._verify1=function(t){p(t.negative===0,"red works only with positives"),p(t.red,"red works only with red numbers")},N.prototype._verify2=function(t,r){p((t.negative|r.negative)===0,"red works only with positives"),p(t.red&&t.red===r.red,"red works only with red numbers")},N.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},N.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},N.prototype.add=function(t,r){this._verify2(t,r);var n=t.add(r);return n.cmp(this.m)>=0&&n.isub(this.m),n._forceRed(this)},N.prototype.iadd=function(t,r){this._verify2(t,r);var n=t.iadd(r);return n.cmp(this.m)>=0&&n.isub(this.m),n},N.prototype.sub=function(t,r){this._verify2(t,r);var n=t.sub(r);return n.cmpn(0)<0&&n.iadd(this.m),n._forceRed(this)},N.prototype.isub=function(t,r){this._verify2(t,r);var n=t.isub(r);return n.cmpn(0)<0&&n.iadd(this.m),n},N.prototype.shl=function(t,r){return this._verify1(t),this.imod(t.ushln(r))},N.prototype.imul=function(t,r){return this._verify2(t,r),this.imod(t.imul(r))},N.prototype.mul=function(t,r){return this._verify2(t,r),this.imod(t.mul(r))},N.prototype.isqr=function(t){return this.imul(t,t.clone())},N.prototype.sqr=function(t){return this.mul(t,t)},N.prototype.sqrt=function(t){if(t.isZero())return t.clone();var r=this.m.andln(3);if(p(r%2===1),r===3){var n=this.m.add(new c(1)).iushrn(2);return this.pow(t,n)}for(var s=this.m.subn(1),f=0;!s.isZero()&&s.andln(1)===0;)f++,s.iushrn(1);p(!s.isZero());var d=new c(1).toRed(this),m=d.redNeg(),o=this.m.subn(1).iushrn(1),e=this.m.bitLength();for(e=new c(2*e*e).toRed(this);this.pow(e,o).cmp(m)!==0;)e.redIAdd(m);for(var h=this.pow(e,s),_=this.pow(t,s.addn(1).iushrn(1)),b=this.pow(t,s),S=f;b.cmp(d)!==0;){for(var x=b,E=0;x.cmp(d)!==0;E++)x=x.redSqr();p(E<S);var q=this.pow(h,new c(1).iushln(S-E-1));_=_.redMul(q),h=q.redSqr(),b=b.redMul(h),S=E}return _},N.prototype.invm=function(t){var r=t._invmp(this.m);return r.negative!==0?(r.negative=0,this.imod(r).redNeg()):this.imod(r)},N.prototype.pow=function(t,r){if(r.isZero())return new c(1).toRed(this);if(r.cmpn(1)===0)return t.clone();var n=4,s=new Array(1<<n);s[0]=new c(1).toRed(this),s[1]=t;for(var f=2;f<s.length;f++)s[f]=this.mul(s[f-1],t);var d=s[0],m=0,o=0,e=r.bitLength()%26;for(e===0&&(e=26),f=r.length-1;f>=0;f--){for(var h=r.words[f],_=e-1;_>=0;_--){var b=h>>_&1;if(d!==s[0]&&(d=this.sqr(d)),b===0&&m===0){o=0;continue}m<<=1,m|=b,o++,!(o!==n&&(f!==0||_!==0))&&(d=this.mul(d,s[m]),o=0,m=0)}e=26}return d},N.prototype.convertTo=function(t){var r=t.umod(this.m);return r===t?r.clone():r},N.prototype.convertFrom=function(t){var r=t.clone();return r.red=null,r},c.mont=function(t){return new Rt(t)};function Rt(l){N.call(this,l),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new c(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}v(Rt,N),Rt.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},Rt.prototype.convertFrom=function(t){var r=this.imod(t.mul(this.rinv));return r.red=null,r},Rt.prototype.imul=function(t,r){if(t.isZero()||r.isZero())return t.words[0]=0,t.length=1,t;var n=t.imul(r),s=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),f=n.isub(s).iushrn(this.shift),d=f;return f.cmp(this.m)>=0?d=f.isub(this.m):f.cmpn(0)<0&&(d=f.iadd(this.m)),d._forceRed(this)},Rt.prototype.mul=function(t,r){if(t.isZero()||r.isZero())return new c(0)._forceRed(this);var n=t.mul(r),s=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),f=n.isub(s).iushrn(this.shift),d=f;return f.cmp(this.m)>=0?d=f.isub(this.m):f.cmpn(0)<0&&(d=f.iadd(this.m)),d._forceRed(this)},Rt.prototype.invm=function(t){var r=this.imod(t._invmp(this.m).mul(this.r2));return r._forceRed(this)}})(a,fr)})(vr);const Mr=fe;var yr=cr.strict,_r=function(i){if(yr(i)){var u=Lt.from(i.buffer);return i.byteLength!==i.buffer.byteLength&&(u=u.slice(i.byteOffset,i.byteOffset+i.byteLength)),u}else return Lt.from(i)};const je="hex",Je="utf8",Pt="0";function qt(a){return new Uint8Array(a)}function We(a,i=!1){const u=a.toString(je);return i?Ot(u):u}function wr(a){return a.toString(Je)}function Ht(a){return _r(a)}function Et(a,i=!1){return We(Ht(a),i)}function br(a){return wr(Ht(a))}function Sr(a){return Lt.from(bt(a),je)}function Tt(a){return qt(Sr(a))}function le(a){return Lt.from(a,Je)}function xr(a){return qt(le(a))}function Rr(a,i=!1){return We(le(a),i)}function kr(a,i){return!(typeof a!="string"||!a.match(/^0x[0-9A-Fa-f]*$/)||i&&a.length!==2+2*i)}function De(...a){let i=[];return a.forEach(u=>i=i.concat(Array.from(u))),new Uint8Array([...i])}function Ir(a,i=8){const u=a%i;return u?(a-u)/i*i+i:a}function Er(a,i=8,u=Pt){return Tr(a,Ir(a.length,i),u)}function Tr(a,i,u=Pt){return Or(a,i,!0,u)}function bt(a){return a.replace(/^0x/,"")}function Ot(a){return a.startsWith("0x")?a:`0x${a}`}function ze(a){return a=bt(a),a=Er(a,2),a&&(a=Ot(a)),a}function qr(a){const i=a.startsWith("0x");return a=bt(a),a=a.startsWith(Pt)?a.substring(1):a,i?Ot(a):a}function Or(a,i,u,p=Pt){const v=i-a.length;let c=a;if(v>0){const T=p.repeat(v);c=u?T+a:a+T}return c}function ue(a){return Ht(new Uint8Array(a))}function Ar(a,i){return Et(new Uint8Array(a),!i)}function Cr(a){return qt(a).buffer}function Nr(a){return le(a)}function Br(a,i){return Rr(a,!i)}function Lr(a){return Tt(a).buffer}function Ke(a,i){const u=bt(ze(new Mr(a).toString(16)));return i?u:Ot(u)}function Bt(a){return ze(a)}function Ur(a){return qr(Ot(a))}const Pr=lr;function se(){return((i,u)=>{for(u=i="";i++<36;u+=i*51&52?(i^15?8^Math.random()*(i^20?16:4):4).toString(16):"-");return u})()}function Hr(a){return a===""||typeof a=="string"&&a.trim()===""}function Fr(a){return!(a&&a.length)}function Qe(a,i){return kr(a,i)}function $r(a){return typeof a.method<"u"}function At(a){return typeof a.result<"u"}function Ut(a){return typeof a.error<"u"}function Be(a){return typeof a.event<"u"}function Zr(a){return gr.includes(a)||a.startsWith("wc_")}function jr(a){return a.method.startsWith("wc_")?!0:!Ze.includes(a.method)}function Jr(a){a=bt(a.toLowerCase());const i=bt(ur.keccak_256(Nr(a)));let u="";for(let p=0;p<a.length;p++)parseInt(i[p],16)>7?u+=a[p].toUpperCase():u+=a[p];return Ot(u)}const Wr=a=>a?a.toLowerCase().substring(0,2)!=="0x"?!1:/^(0x)?[0-9a-f]{40}$/i.test(a)?/^(0x)?[0-9a-f]{40}$/.test(a)||/^(0x)?[0-9A-F]{40}$/.test(a)?!0:a===Jr(a):!1:!1;function Le(a){return!Fr(a)&&!Qe(a[0])&&(a[0]=Br(a[0])),a}function oe(a){if(typeof a.type<"u"&&a.type!=="0")return a;if(typeof a.from>"u"||!Wr(a.from))throw new Error("Transaction object must include a valid 'from' value.");function i(v){let c=v;return(typeof v=="number"||typeof v=="string"&&!Hr(v))&&(Qe(v)?typeof v=="string"&&(c=Bt(v)):c=Ke(v)),typeof c=="string"&&(c=Ur(c)),c}const u={from:Bt(a.from),to:typeof a.to>"u"?void 0:Bt(a.to),gasPrice:typeof a.gasPrice>"u"?"":i(a.gasPrice),gas:typeof a.gas>"u"?typeof a.gasLimit>"u"?"":i(a.gasLimit):i(a.gas),value:typeof a.value>"u"?"":i(a.value),nonce:typeof a.nonce>"u"?"":i(a.nonce),data:typeof a.data>"u"?"":Bt(a.data)||"0x"},p=["gasPrice","gas","value","nonce"];return Object.keys(u).forEach(v=>{(typeof u[v]>"u"||typeof u[v]=="string"&&!u[v].trim().length)&&p.includes(v)&&delete u[v]}),u}function Dr(a){const i=a.message||"Failed or Rejected Request";let u=-32e3;if(a&&!a.code)switch(i){case"Parse error":u=-32700;break;case"Invalid request":u=-32600;break;case"Method not found":u=-32601;break;case"Invalid params":u=-32602;break;case"Internal error":u=-32603;break;default:u=-32e3;break}const p={code:u,message:i};return a.data&&(p.data=a.data),p}var de={};(function(a){const i=pr,u=mr,p=dr,v=g=>g==null;function c(g){switch(g.arrayFormat){case"index":return M=>(w,y)=>{const R=w.length;return y===void 0||g.skipNull&&y===null||g.skipEmptyString&&y===""?w:y===null?[...w,[I(M,g),"[",R,"]"].join("")]:[...w,[I(M,g),"[",I(R,g),"]=",I(y,g)].join("")]};case"bracket":return M=>(w,y)=>y===void 0||g.skipNull&&y===null||g.skipEmptyString&&y===""?w:y===null?[...w,[I(M,g),"[]"].join("")]:[...w,[I(M,g),"[]=",I(y,g)].join("")];case"comma":case"separator":return M=>(w,y)=>y==null||y.length===0?w:w.length===0?[[I(M,g),"=",I(y,g)].join("")]:[[w,I(y,g)].join(g.arrayFormatSeparator)];default:return M=>(w,y)=>y===void 0||g.skipNull&&y===null||g.skipEmptyString&&y===""?w:y===null?[...w,I(M,g)]:[...w,[I(M,g),"=",I(y,g)].join("")]}}function T(g){let M;switch(g.arrayFormat){case"index":return(w,y,R)=>{if(M=/\[(\d*)\]$/.exec(w),w=w.replace(/\[\d*\]$/,""),!M){R[w]=y;return}R[w]===void 0&&(R[w]={}),R[w][M[1]]=y};case"bracket":return(w,y,R)=>{if(M=/(\[\])$/.exec(w),w=w.replace(/\[\]$/,""),!M){R[w]=y;return}if(R[w]===void 0){R[w]=[y];return}R[w]=[].concat(R[w],y)};case"comma":case"separator":return(w,y,R)=>{const k=typeof y=="string"&&y.split("").indexOf(g.arrayFormatSeparator)>-1?y.split(g.arrayFormatSeparator).map(vt=>gt(vt,g)):y===null?y:gt(y,g);R[w]=k};default:return(w,y,R)=>{if(R[w]===void 0){R[w]=y;return}R[w]=[].concat(R[w],y)}}}function mt(g){if(typeof g!="string"||g.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function I(g,M){return M.encode?M.strict?i(g):encodeURIComponent(g):g}function gt(g,M){return M.decode?u(g):g}function xt(g){return Array.isArray(g)?g.sort():typeof g=="object"?xt(Object.keys(g)).sort((M,w)=>Number(M)-Number(w)).map(M=>g[M]):g}function yt(g){const M=g.indexOf("#");return M!==-1&&(g=g.slice(0,M)),g}function _t(g){let M="";const w=g.indexOf("#");return w!==-1&&(M=g.slice(w)),M}function Mt(g){g=yt(g);const M=g.indexOf("?");return M===-1?"":g.slice(M+1)}function It(g,M){return M.parseNumbers&&!Number.isNaN(Number(g))&&typeof g=="string"&&g.trim()!==""?g=Number(g):M.parseBooleans&&g!==null&&(g.toLowerCase()==="true"||g.toLowerCase()==="false")&&(g=g.toLowerCase()==="true"),g}function Nt(g,M){M=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},M),mt(M.arrayFormatSeparator);const w=T(M),y=Object.create(null);if(typeof g!="string"||(g=g.trim().replace(/^[?#&]/,""),!g))return y;for(const R of g.split("&")){let[C,k]=p(M.decode?R.replace(/\+/g," "):R,"=");k=k===void 0?null:["comma","separator"].includes(M.arrayFormat)?k:gt(k,M),w(gt(C,M),k,y)}for(const R of Object.keys(y)){const C=y[R];if(typeof C=="object"&&C!==null)for(const k of Object.keys(C))C[k]=It(C[k],M);else y[R]=It(C,M)}return M.sort===!1?y:(M.sort===!0?Object.keys(y).sort():Object.keys(y).sort(M.sort)).reduce((R,C)=>{const k=y[C];return k&&typeof k=="object"&&!Array.isArray(k)?R[C]=xt(k):R[C]=k,R},Object.create(null))}a.extract=Mt,a.parse=Nt,a.stringify=(g,M)=>{if(!g)return"";M=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},M),mt(M.arrayFormatSeparator);const w=k=>M.skipNull&&v(g[k])||M.skipEmptyString&&g[k]==="",y=c(M),R={};for(const k of Object.keys(g))w(k)||(R[k]=g[k]);const C=Object.keys(R);return M.sort!==!1&&C.sort(M.sort),C.map(k=>{const vt=g[k];return vt===void 0?"":vt===null?I(k,M):Array.isArray(vt)?vt.reduce(y(k),[]).join("&"):I(k,M)+"="+I(vt,M)}).filter(k=>k.length>0).join("&")},a.parseUrl=(g,M)=>{M=Object.assign({decode:!0},M);const[w,y]=p(g,"#");return Object.assign({url:w.split("?")[0]||"",query:Nt(Mt(g),M)},M&&M.parseFragmentIdentifier&&y?{fragmentIdentifier:gt(y,M)}:{})},a.stringifyUrl=(g,M)=>{M=Object.assign({encode:!0,strict:!0},M);const w=yt(g.url).split("?")[0]||"",y=a.extract(g.url),R=a.parse(y,{sort:!1}),C=Object.assign(R,g.query);let k=a.stringify(C,M);k&&(k=`?${k}`);let vt=_t(g.url);return g.fragmentIdentifier&&(vt=`#${I(g.fragmentIdentifier,M)}`),`${w}${k}${vt}`}})(de);function zr(a){const i=a.indexOf("?")!==-1?a.indexOf("?"):void 0;return typeof i<"u"?a.substr(i):""}function Kr(a,i){let u=Ge(a);return u=Object.assign(Object.assign({},u),i),a=Qr(u),a}function Ge(a){return de.parse(a)}function Qr(a){return de.stringify(a)}function Gr(a){return typeof a.bridge<"u"}function Vr(a){const i=a.indexOf(":"),u=a.indexOf("?")!==-1?a.indexOf("?"):void 0,p=a.substring(0,i),v=a.substring(i+1,u);function c(yt){const _t="@",Mt=yt.split(_t);return{handshakeTopic:Mt[0],version:parseInt(Mt[1],10)}}const T=c(v),mt=typeof u<"u"?a.substr(u):"";function I(yt){const _t=Ge(yt);return{key:_t.key||"",bridge:_t.bridge||""}}const gt=I(mt);return Object.assign(Object.assign({protocol:p},T),gt)}var he,Ue;function Yr(){return Ue||(Ue=1,he=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),he}class Xr{constructor(){this._eventEmitters=[],typeof window<"u"&&typeof window.addEventListener<"u"&&(window.addEventListener("online",()=>this.trigger("online")),window.addEventListener("offline",()=>this.trigger("offline")))}on(i,u){this._eventEmitters.push({event:i,callback:u})}trigger(i){let u=[];i&&(u=this._eventEmitters.filter(p=>p.event===i)),u.forEach(p=>{p.callback()})}}const ti=typeof Ne.WebSocket<"u"?Ne.WebSocket:Yr();class ei{constructor(i){if(this.opts=i,this._queue=[],this._events=[],this._subscriptions=[],this._protocol=i.protocol,this._version=i.version,this._url="",this._netMonitor=null,this._socket=null,this._nextSocket=null,this._subscriptions=i.subscriptions||[],this._netMonitor=i.netMonitor||new Xr,!i.url||typeof i.url!="string")throw new Error("Missing or invalid WebSocket url");this._url=i.url,this._netMonitor.on("online",()=>this._socketCreate())}set readyState(i){}get readyState(){return this._socket?this._socket.readyState:-1}set connecting(i){}get connecting(){return this.readyState===0}set connected(i){}get connected(){return this.readyState===1}set closing(i){}get closing(){return this.readyState===2}set closed(i){}get closed(){return this.readyState===3}open(){this._socketCreate()}close(){this._socketClose()}send(i,u,p){if(!u||typeof u!="string")throw new Error("Missing or invalid topic field");this._socketSend({topic:u,type:"pub",payload:i,silent:!!p})}subscribe(i){this._socketSend({topic:i,type:"sub",payload:"",silent:!0})}on(i,u){this._events.push({event:i,callback:u})}_socketCreate(){if(this._nextSocket)return;const i=ri(this._url,this._protocol,this._version);if(this._nextSocket=new ti(i),!this._nextSocket)throw new Error("Failed to create socket");this._nextSocket.onmessage=u=>this._socketReceive(u),this._nextSocket.onopen=()=>this._socketOpen(),this._nextSocket.onerror=u=>this._socketError(u),this._nextSocket.onclose=()=>{setTimeout(()=>{this._nextSocket=null,this._socketCreate()},1e3)}}_socketOpen(){this._socketClose(),this._socket=this._nextSocket,this._nextSocket=null,this._queueSubscriptions(),this._pushQueue()}_socketClose(){this._socket&&(this._socket.onclose=()=>{},this._socket.close())}_socketSend(i){const u=JSON.stringify(i);this._socket&&this._socket.readyState===1?this._socket.send(u):(this._setToQueue(i),this._socketCreate())}async _socketReceive(i){let u;try{u=JSON.parse(i.data)}catch{return}if(this._socketSend({topic:u.topic,type:"ack",payload:"",silent:!0}),this._socket&&this._socket.readyState===1){const p=this._events.filter(v=>v.event==="message");p&&p.length&&p.forEach(v=>v.callback(u))}}_socketError(i){const u=this._events.filter(p=>p.event==="error");u&&u.length&&u.forEach(p=>p.callback(i))}_queueSubscriptions(){this._subscriptions.forEach(u=>this._queue.push({topic:u,type:"sub",payload:"",silent:!0})),this._subscriptions=this.opts.subscriptions||[]}_setToQueue(i){this._queue.push(i)}_pushQueue(){this._queue.forEach(u=>this._socketSend(u)),this._queue=[]}}function ri(a,i,u){var p,v;const T=(a.startsWith("https")?a.replace("https","wss"):a.startsWith("http")?a.replace("http","ws"):a).split("?"),mt=ir()?{protocol:i,version:u,env:"browser",host:((p=nr())===null||p===void 0?void 0:p.host)||""}:{protocol:i,version:u,env:((v=sr())===null||v===void 0?void 0:v.name)||""},I=Kr(zr(T[1]||""),mt);return T[0]+"?"+I}const ae="Session currently connected",kt="Session currently disconnected",ii="Session Rejected",ni="Missing JSON RPC response",si='JSON-RPC success response must include "result" field',oi='JSON-RPC error response must include "error" field',hi='JSON RPC request must have valid "method" value',ai='JSON RPC request must have valid "id" value',fi="Missing one of the required parameters: bridge / uri / session",Pe="JSON RPC response format is invalid",ui="URI format is invalid",ci="QRCode Modal not provided",He="User close QRCode Modal";class li{constructor(){this._eventEmitters=[]}subscribe(i){this._eventEmitters.push(i)}unsubscribe(i){this._eventEmitters=this._eventEmitters.filter(u=>u.event!==i)}trigger(i){let u=[],p;$r(i)?p=i.method:At(i)||Ut(i)?p=`response:${i.id}`:Be(i)?p=i.event:p="",p&&(u=this._eventEmitters.filter(v=>v.event===p)),(!u||!u.length)&&!Zr(p)&&!Be(p)&&(u=this._eventEmitters.filter(v=>v.event==="call_request")),u.forEach(v=>{if(Ut(i)){const c=new Error(i.error.message);v.callback(c,null)}else v.callback(null,i)})}}class di{constructor(i="walletconnect"){this.storageId=i}getSession(){let i=null;const u=Fe(this.storageId);return u&&Gr(u)&&(i=u),i}setSession(i){return or(this.storageId,i),i}removeSession(){$e(this.storageId)}}const pi="walletconnect.org",mi="abcdefghijklmnopqrstuvwxyz0123456789",Ve=mi.split("").map(a=>`https://${a}.bridge.walletconnect.org`);function gi(a){let i=a.indexOf("//")>-1?a.split("/")[2]:a.split("/")[0];return i=i.split(":")[0],i=i.split("?")[0],i}function vi(a){return gi(a).split(".").slice(-2).join(".")}function Mi(){return Math.floor(Math.random()*Ve.length)}function yi(){return Ve[Mi()]}function _i(a){return vi(a)===pi}function wi(a){return _i(a)?yi():a}class bi{constructor(i){if(this.protocol="wc",this.version=1,this._bridge="",this._key=null,this._clientId="",this._clientMeta=null,this._peerId="",this._peerMeta=null,this._handshakeId=0,this._handshakeTopic="",this._connected=!1,this._accounts=[],this._chainId=0,this._networkId=0,this._rpcUrl="",this._eventManager=new li,this._clientMeta=Ae()||i.connectorOpts.clientMeta||null,this._cryptoLib=i.cryptoLib,this._sessionStorage=i.sessionStorage||new di(i.connectorOpts.storageId),this._qrcodeModal=i.connectorOpts.qrcodeModal,this._qrcodeModalOptions=i.connectorOpts.qrcodeModalOptions,this._signingMethods=[...Ze,...i.connectorOpts.signingMethods||[]],!i.connectorOpts.bridge&&!i.connectorOpts.uri&&!i.connectorOpts.session)throw new Error(fi);i.connectorOpts.bridge&&(this.bridge=wi(i.connectorOpts.bridge)),i.connectorOpts.uri&&(this.uri=i.connectorOpts.uri);const u=i.connectorOpts.session||this._getStorageSession();u&&(this.session=u),this.handshakeId&&this._subscribeToSessionResponse(this.handshakeId,"Session request rejected"),this._transport=i.transport||new ei({protocol:this.protocol,version:this.version,url:this.bridge,subscriptions:[this.clientId]}),this._subscribeToInternalEvents(),this._initTransport(),i.connectorOpts.uri&&this._subscribeToSessionRequest(),i.pushServerOpts&&this._registerPushServer(i.pushServerOpts)}set bridge(i){i&&(this._bridge=i)}get bridge(){return this._bridge}set key(i){if(!i)return;const u=Lr(i);this._key=u}get key(){return this._key?Ar(this._key,!0):""}set clientId(i){i&&(this._clientId=i)}get clientId(){let i=this._clientId;return i||(i=this._clientId=se()),this._clientId}set peerId(i){i&&(this._peerId=i)}get peerId(){return this._peerId}set clientMeta(i){}get clientMeta(){let i=this._clientMeta;return i||(i=this._clientMeta=Ae()),i}set peerMeta(i){this._peerMeta=i}get peerMeta(){return this._peerMeta}set handshakeTopic(i){i&&(this._handshakeTopic=i)}get handshakeTopic(){return this._handshakeTopic}set handshakeId(i){i&&(this._handshakeId=i)}get handshakeId(){return this._handshakeId}get uri(){return this._formatUri()}set uri(i){if(!i)return;const{handshakeTopic:u,bridge:p,key:v}=this._parseUri(i);this.handshakeTopic=u,this.bridge=p,this.key=v}set chainId(i){this._chainId=i}get chainId(){return this._chainId}set networkId(i){this._networkId=i}get networkId(){return this._networkId}set accounts(i){this._accounts=i}get accounts(){return this._accounts}set rpcUrl(i){this._rpcUrl=i}get rpcUrl(){return this._rpcUrl}set connected(i){}get connected(){return this._connected}set pending(i){}get pending(){return!!this._handshakeTopic}get session(){return{connected:this.connected,accounts:this.accounts,chainId:this.chainId,bridge:this.bridge,key:this.key,clientId:this.clientId,clientMeta:this.clientMeta,peerId:this.peerId,peerMeta:this.peerMeta,handshakeId:this.handshakeId,handshakeTopic:this.handshakeTopic}}set session(i){i&&(this._connected=i.connected,this.accounts=i.accounts,this.chainId=i.chainId,this.bridge=i.bridge,this.key=i.key,this.clientId=i.clientId,this.clientMeta=i.clientMeta,this.peerId=i.peerId,this.peerMeta=i.peerMeta,this.handshakeId=i.handshakeId,this.handshakeTopic=i.handshakeTopic)}on(i,u){const p={event:i,callback:u};this._eventManager.subscribe(p)}off(i){this._eventManager.unsubscribe(i)}async createInstantRequest(i){this._key=await this._generateKey();const u=this._formatRequest({method:"wc_instantRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,request:this._formatRequest(i)}]});this.handshakeId=u.id,this.handshakeTopic=se(),this._eventManager.trigger({event:"display_uri",params:[this.uri]}),this.on("modal_closed",()=>{throw new Error(He)});const p=()=>{this.killSession()};try{const v=await this._sendCallRequest(u);return v&&p(),v}catch(v){throw p(),v}}async connect(i){if(!this._qrcodeModal)throw new Error(ci);return this.connected?{chainId:this.chainId,accounts:this.accounts}:(await this.createSession(i),new Promise(async(u,p)=>{this.on("modal_closed",()=>p(new Error(He))),this.on("connect",(v,c)=>{if(v)return p(v);u(c.params[0])})}))}async createSession(i){if(this._connected)throw new Error(ae);if(this.pending)return;this._key=await this._generateKey();const u=this._formatRequest({method:"wc_sessionRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,chainId:i&&i.chainId?i.chainId:null}]});this.handshakeId=u.id,this.handshakeTopic=se(),this._sendSessionRequest(u,"Session update rejected",{topic:this.handshakeTopic}),this._eventManager.trigger({event:"display_uri",params:[this.uri]})}approveSession(i){if(this._connected)throw new Error(ae);this.chainId=i.chainId,this.accounts=i.accounts,this.networkId=i.networkId||0,this.rpcUrl=i.rpcUrl||"";const u={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl,peerId:this.clientId,peerMeta:this.clientMeta},p={id:this.handshakeId,jsonrpc:"2.0",result:u};this._sendResponse(p),this._connected=!0,this._setStorageSession(),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})}rejectSession(i){if(this._connected)throw new Error(ae);const u=i&&i.message?i.message:ii,p=this._formatResponse({id:this.handshakeId,error:{message:u}});this._sendResponse(p),this._connected=!1,this._eventManager.trigger({event:"disconnect",params:[{message:u}]}),this._removeStorageSession()}updateSession(i){if(!this._connected)throw new Error(kt);this.chainId=i.chainId,this.accounts=i.accounts,this.networkId=i.networkId||0,this.rpcUrl=i.rpcUrl||"";const u={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl},p=this._formatRequest({method:"wc_sessionUpdate",params:[u]});this._sendSessionRequest(p,"Session update rejected"),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]}),this._manageStorageSession()}async killSession(i){const u=i?i.message:"Session Disconnected",p={approved:!1,chainId:null,networkId:null,accounts:null},v=this._formatRequest({method:"wc_sessionUpdate",params:[p]});await this._sendRequest(v),this._handleSessionDisconnect(u)}async sendTransaction(i){if(!this._connected)throw new Error(kt);const u=oe(i),p=this._formatRequest({method:"eth_sendTransaction",params:[u]});return await this._sendCallRequest(p)}async signTransaction(i){if(!this._connected)throw new Error(kt);const u=oe(i),p=this._formatRequest({method:"eth_signTransaction",params:[u]});return await this._sendCallRequest(p)}async signMessage(i){if(!this._connected)throw new Error(kt);const u=this._formatRequest({method:"eth_sign",params:i});return await this._sendCallRequest(u)}async signPersonalMessage(i){if(!this._connected)throw new Error(kt);i=Le(i);const u=this._formatRequest({method:"personal_sign",params:i});return await this._sendCallRequest(u)}async signTypedData(i){if(!this._connected)throw new Error(kt);const u=this._formatRequest({method:"eth_signTypedData",params:i});return await this._sendCallRequest(u)}async updateChain(i){if(!this._connected)throw new Error("Session currently disconnected");const u=this._formatRequest({method:"wallet_updateChain",params:[i]});return await this._sendCallRequest(u)}unsafeSend(i,u){return this._sendRequest(i,u),this._eventManager.trigger({event:"call_request_sent",params:[{request:i,options:u}]}),new Promise((p,v)=>{this._subscribeToResponse(i.id,(c,T)=>{if(c){v(c);return}if(!T)throw new Error(ni);p(T)})})}async sendCustomRequest(i,u){if(!this._connected)throw new Error(kt);switch(i.method){case"eth_accounts":return this.accounts;case"eth_chainId":return Ke(this.chainId);case"eth_sendTransaction":case"eth_signTransaction":i.params&&(i.params[0]=oe(i.params[0]));break;case"personal_sign":i.params&&(i.params=Le(i.params));break}const p=this._formatRequest(i);return await this._sendCallRequest(p,u)}approveRequest(i){if(At(i)){const u=this._formatResponse(i);this._sendResponse(u)}else throw new Error(si)}rejectRequest(i){if(Ut(i)){const u=this._formatResponse(i);this._sendResponse(u)}else throw new Error(oi)}transportClose(){this._transport.close()}async _sendRequest(i,u){const p=this._formatRequest(i),v=await this._encrypt(p),c=typeof(u==null?void 0:u.topic)<"u"?u.topic:this.peerId,T=JSON.stringify(v),mt=typeof(u==null?void 0:u.forcePushNotification)<"u"?!u.forcePushNotification:jr(p);this._transport.send(T,c,mt)}async _sendResponse(i){const u=await this._encrypt(i),p=this.peerId,v=JSON.stringify(u),c=!0;this._transport.send(v,p,c)}async _sendSessionRequest(i,u,p){this._sendRequest(i,p),this._subscribeToSessionResponse(i.id,u)}_sendCallRequest(i,u){return this._sendRequest(i,u),this._eventManager.trigger({event:"call_request_sent",params:[{request:i,options:u}]}),this._subscribeToCallResponse(i.id)}_formatRequest(i){if(typeof i.method>"u")throw new Error(hi);return{id:typeof i.id>"u"?Pr():i.id,jsonrpc:"2.0",method:i.method,params:typeof i.params>"u"?[]:i.params}}_formatResponse(i){if(typeof i.id>"u")throw new Error(ai);const u={id:i.id,jsonrpc:"2.0"};if(Ut(i)){const p=Dr(i.error);return Object.assign(Object.assign(Object.assign({},u),i),{error:p})}else if(At(i))return Object.assign(Object.assign({},u),i);throw new Error(Pe)}_handleSessionDisconnect(i){const u=i||"Session Disconnected";this._connected||(this._qrcodeModal&&this._qrcodeModal.close(),$e(Ce)),this._connected&&(this._connected=!1),this._handshakeId&&(this._handshakeId=0),this._handshakeTopic&&(this._handshakeTopic=""),this._peerId&&(this._peerId=""),this._eventManager.trigger({event:"disconnect",params:[{message:u}]}),this._removeStorageSession(),this.transportClose()}_handleSessionResponse(i,u){u?u.approved?(this._connected?(u.chainId&&(this.chainId=u.chainId),u.accounts&&(this.accounts=u.accounts),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]})):(this._connected=!0,u.chainId&&(this.chainId=u.chainId),u.accounts&&(this.accounts=u.accounts),u.peerId&&!this.peerId&&(this.peerId=u.peerId),u.peerMeta&&!this.peerMeta&&(this.peerMeta=u.peerMeta),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})),this._manageStorageSession()):this._handleSessionDisconnect(i):this._handleSessionDisconnect(i)}async _handleIncomingMessages(i){if(![this.clientId,this.handshakeTopic].includes(i.topic))return;let p;try{p=JSON.parse(i.payload)}catch{return}const v=await this._decrypt(p);v&&this._eventManager.trigger(v)}_subscribeToSessionRequest(){this._transport.subscribe(this.handshakeTopic)}_subscribeToResponse(i,u){this.on(`response:${i}`,u)}_subscribeToSessionResponse(i,u){this._subscribeToResponse(i,(p,v)=>{if(p){this._handleSessionResponse(p.message);return}At(v)?this._handleSessionResponse(u,v.result):v.error&&v.error.message?this._handleSessionResponse(v.error.message):this._handleSessionResponse(u)})}_subscribeToCallResponse(i){return new Promise((u,p)=>{this._subscribeToResponse(i,(v,c)=>{if(v){p(v);return}At(c)?u(c.result):c.error&&c.error.message?p(c.error):p(new Error(Pe))})})}_subscribeToInternalEvents(){this.on("display_uri",()=>{this._qrcodeModal&&this._qrcodeModal.open(this.uri,()=>{this._eventManager.trigger({event:"modal_closed",params:[]})},this._qrcodeModalOptions)}),this.on("connect",()=>{this._qrcodeModal&&this._qrcodeModal.close()}),this.on("call_request_sent",(i,u)=>{const{request:p}=u.params[0];if(hr()&&this._signingMethods.includes(p.method)){const v=Fe(Ce);v&&(window.location.href=v.href)}}),this.on("wc_sessionRequest",(i,u)=>{i&&this._eventManager.trigger({event:"error",params:[{code:"SESSION_REQUEST_ERROR",message:i.toString()}]}),this.handshakeId=u.id,this.peerId=u.params[0].peerId,this.peerMeta=u.params[0].peerMeta;const p=Object.assign(Object.assign({},u),{method:"session_request"});this._eventManager.trigger(p)}),this.on("wc_sessionUpdate",(i,u)=>{i&&this._handleSessionResponse(i.message),this._handleSessionResponse("Session disconnected",u.params[0])})}_initTransport(){this._transport.on("message",i=>this._handleIncomingMessages(i)),this._transport.on("open",()=>this._eventManager.trigger({event:"transport_open",params:[]})),this._transport.on("close",()=>this._eventManager.trigger({event:"transport_close",params:[]})),this._transport.on("error",()=>this._eventManager.trigger({event:"transport_error",params:["Websocket connection failed"]})),this._transport.open()}_formatUri(){const i=this.protocol,u=this.handshakeTopic,p=this.version,v=encodeURIComponent(this.bridge),c=this.key;return`${i}:${u}@${p}?bridge=${v}&key=${c}`}_parseUri(i){const u=Vr(i);if(u.protocol===this.protocol){if(!u.handshakeTopic)throw Error("Invalid or missing handshakeTopic parameter value");const p=u.handshakeTopic;if(!u.bridge)throw Error("Invalid or missing bridge url parameter value");const v=decodeURIComponent(u.bridge);if(!u.key)throw Error("Invalid or missing key parameter value");const c=u.key;return{handshakeTopic:p,bridge:v,key:c}}else throw new Error(ui)}async _generateKey(){return this._cryptoLib?await this._cryptoLib.generateKey():null}async _encrypt(i){const u=this._key;return this._cryptoLib&&u?await this._cryptoLib.encrypt(i,u):null}async _decrypt(i){const u=this._key;return this._cryptoLib&&u?await this._cryptoLib.decrypt(i,u):null}_getStorageSession(){let i=null;return this._sessionStorage&&(i=this._sessionStorage.getSession()),i}_setStorageSession(){this._sessionStorage&&this._sessionStorage.setSession(this.session)}_removeStorageSession(){this._sessionStorage&&this._sessionStorage.removeSession()}_manageStorageSession(){this._connected?this._setStorageSession():this._removeStorageSession()}_registerPushServer(i){if(!i.url||typeof i.url!="string")throw Error("Invalid or missing pushServerOpts.url parameter value");if(!i.type||typeof i.type!="string")throw Error("Invalid or missing pushServerOpts.type parameter value");if(!i.token||typeof i.token!="string")throw Error("Invalid or missing pushServerOpts.token parameter value");const u={bridge:this.bridge,topic:this.clientId,type:i.type,token:i.token,peerName:"",language:i.language||""};this.on("connect",async(p,v)=>{if(p)throw p;if(i.peerMeta){const c=v.params[0].peerMeta.name;u.peerName=c}try{if(!(await(await fetch(`${i.url}/new`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(u)})).json()).success)throw Error("Failed to register in Push Server")}catch{throw Error("Failed to register in Push Server")}})}}function Si(a){return Ct.getBrowerCrypto().getRandomValues(new Uint8Array(a))}const Ye=256,Xe=Ye,xi=Ye,St="AES-CBC",Ri=`SHA-${Xe}`,ce="HMAC",ki="encrypt",Ii="decrypt",Ei="sign",Ti="verify";function qi(a){return a===St?{length:Xe,name:St}:{hash:{name:Ri},name:ce}}function Oi(a){return a===St?[ki,Ii]:[Ei,Ti]}async function pe(a,i=St){return Ct.getSubtleCrypto().importKey("raw",a,qi(i),!0,Oi(i))}async function Ai(a,i,u){const p=Ct.getSubtleCrypto(),v=await pe(i,St),c=await p.encrypt({iv:a,name:St},v,u);return new Uint8Array(c)}async function Ci(a,i,u){const p=Ct.getSubtleCrypto(),v=await pe(i,St),c=await p.decrypt({iv:a,name:St},v,u);return new Uint8Array(c)}async function Ni(a,i){const u=Ct.getSubtleCrypto(),p=await pe(a,ce),v=await u.sign({length:xi,name:ce},p,i);return new Uint8Array(v)}function Bi(a,i,u){return Ai(a,i,u)}function Li(a,i,u){return Ci(a,i,u)}async function tr(a,i){return await Ni(a,i)}async function er(a){const i=(a||256)/8,u=Si(i);return Cr(Ht(u))}async function rr(a,i){const u=Tt(a.data),p=Tt(a.iv),v=Tt(a.hmac),c=Et(v,!1),T=De(u,p),mt=await tr(i,T),I=Et(mt,!1);return bt(c)===bt(I)}async function Ui(a,i,u){const p=qt(ue(i)),v=u||await er(128),c=qt(ue(v)),T=Et(c,!1),mt=JSON.stringify(a),I=xr(mt),gt=await Bi(c,p,I),xt=Et(gt,!1),yt=De(gt,c),_t=await tr(p,yt),Mt=Et(_t,!1);return{data:xt,hmac:Mt,iv:T}}async function Pi(a,i){const u=qt(ue(i));if(!u)throw new Error("Missing key: required for decryption");if(!await rr(a,u))return null;const v=Tt(a.data),c=Tt(a.iv),T=await Li(c,u,v),mt=br(T);let I;try{I=JSON.parse(mt)}catch{return null}return I}const Hi=Object.freeze(Object.defineProperty({__proto__:null,decrypt:Pi,encrypt:Ui,generateKey:er,verifyHmac:rr},Symbol.toStringTag,{value:"Module"}));class zi extends bi{constructor(i,u){super({cryptoLib:Hi,connectorOpts:i,pushServerOpts:u})}}export{zi as default};
