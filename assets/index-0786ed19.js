import{c as A,_ as x}from"./BeefyV2AppMulticall-c5605e28.js";import{f2 as E,f3 as V,bp as T,f4 as M,f5 as q,f6 as R,bb as d,ab as B,aC as u}from"./index-40f6b818.js";const U=x;class O{constructor(e,s){this.web3=e,this.chain=s}async fetchAllContractData(e,s,r,o){const l=new this.web3.eth.Contract(U,this.chain.appMulticallContractAddress),i=E(this.chain.id),C=o?[]:A(o,i),F=r?[]:A(r,i),g=A(s,i),f=[];C.forEach(t=>{f.push({method:l.methods.getBoostInfo(t.map(a=>a.earnContractAddress)).call,params:{from:"0x0000000000000000000000000000000000000000"}})}),g.forEach(t=>{f.push({method:l.methods.getVaultInfo(t.map(a=>a.earnContractAddress)).call,params:{from:"0x0000000000000000000000000000000000000000"}})}),F.forEach(t=>{f.push({method:l.methods.getGovVaultInfo(t.map(a=>a.earnContractAddress)).call,params:{from:"0x0000000000000000000000000000000000000000"}})}),console.log("debug start batch request");const w=await V(this.web3,f);console.log("debug finish batch request");const c={boosts:[],govVaults:[],standardVaults:[],prices:[]};let h=0;for(const t of C){const a=w[h].map((p,m)=>this.boostFormatter(e,p,t[m]));c.boosts=c.boosts.concat(a),h++}for(const t of g){const a=w[h].map((p,m)=>this.standardVaultFormatter(e,p,t[m]));c.standardVaults=c.standardVaults.concat(a),h++}for(const t of F){const a=w[h].map((p,m)=>this.govVaultFormatter(e,p,t[m]));c.govVaults=c.govVaults.concat(a),h++}const y=new T.MultiCall(await this.web3,this.chain.multicallAddress),b=new this.web3.eth.Contract(M,"0x87d8F4F150Ddd4D21fB6120a22c402fAA466dAC3"),I=new this.web3.eth.Contract(q,"0x327Df1E6de05895d2ab08513aaDD9313Fe505d86"),D=new this.web3.eth.Contract(R,"0x2D6C22b420878A74c8D297Ab974C66F877C8FcbD"),k=new this.web3.eth.Contract(R,"0x0054Ea29b4aD3BA6eb26Ef92478FCb6Eebe4083C"),P=o.map(t=>[{poolInfo:b.methods.poolInfo(t.farmPid)}]),S=r.map(t=>[{poolInfo:b.methods.poolInfo(t.farmPid)}]),v=[[{curRewardRate:b.methods.curRewardRate(),totalAllocPoint:b.methods.totalAllocPoint()},{bfarmLpTotalBalance:k.methods.totalSupply()},{bfarmUsdcPrice:I.methods.getAmountsOut(new d(1).shiftedBy(18).toString(),["0x2D6C22b420878A74c8D297Ab974C66F877C8FcbD","0x4200000000000000000000000000000000000006","0xd9aAEc86B65D86f6A7B5B1b0c42FFA531710b6CA"])},{bfarmLpBfarmBalance:D.methods.balanceOf("0x0054Ea29b4aD3BA6eb26Ef92478FCb6Eebe4083C")}]],n=await y.all(v.concat(P).concat(S));return console.log("debug master response",n),o.map((t,a)=>{c.boosts.push({id:t.id,totalSupply:new d(n[1+a][0].poolInfo[1]),rewardRate:new d(n[1+a][0].poolInfo[2]*n[0][0].curRewardRate/n[0][0].totalAllocPoint).shiftedBy(-18),periodFinish:new Date(17104608e5),isPreStake:!1})}),r.map((t,a)=>{c.govVaults.push({id:t.id,totalSupply:new d(n[1+o.length+a][0].poolInfo[1]),rewardRate:new d(n[1+o.length+a][0].poolInfo[2]*n[0][0].curRewardRate/n[0][0].totalAllocPoint).shiftedBy(-18)})}),c.prices.push({id:"BFARM",price:new d(n[0][2].bfarmUsdcPrice[2]).div(1e6).toNumber()}),c.prices.push({id:"baseswap-bfarm-weth",price:n[0][2].bfarmUsdcPrice[2]*n[0][3].bfarmLpBfarmBalance/n[0][1].bfarmLpTotalBalance/1e6}),console.log("debug after parse: ",c),c}standardVaultFormatter(e,s,r){const o=B(e,r.id),l=u(e,o.chainId,o.earnContractAddress),i=u(e,o.chainId,o.depositTokenAddress);return{id:r.id,balance:new d(s.balance).shiftedBy(-i.decimals),pricePerFullShare:new d(s.pricePerFullShare).shiftedBy(-l.decimals),strategy:s.strategy}}govVaultFormatter(e,s,r){const o=B(e,r.id),l=u(e,o.chainId,o.depositTokenAddress);return{id:r.id,totalSupply:new d(s.totalSupply).shiftedBy(-l.decimals)}}boostFormatter(e,s,r){const o=u(e,r.chainId,r.earnedTokenAddress),l=B(e,r.vaultId),i=u(e,l.chainId,l.depositTokenAddress);return{id:r.id,totalSupply:new d(s.totalSupply).shiftedBy(-i.decimals),rewardRate:new d(s.rewardRate).shiftedBy(-o.decimals),periodFinish:s.periodFinish==="0"?null:new Date(parseInt(s.periodFinish)*1e3),isPreStake:s.isPreStake}}}export{O as ContractDataAPI};
