import{gP as h,ab as m,v as y,bo as C,aC as p,gT as w,gU as A,bb as T,cf as l,a$ as k,c6 as I,gR as B,gS as x,fL as S}from"./index-40f6b818.js";import{b as v}from"./migration-97db9f5a.js";const f="0xa26C2A6BfeC5512c13Ae9EacF41Cb4319d30cCF0",V=h("migration/polygon-pearl/update",async({vaultId:t,walletAddress:a},{getState:r})=>{const o=r(),d=m(o,t),s=y(o,d.chainId),n=await C(s),e=p(o,d.chainId,d.depositTokenAddress),i=await new n.eth.Contract(w,f).methods.gauges(e.address).call(),u=await new n.eth.Contract(A,i).methods.balanceOf(a).call(),b=new T(u).shiftedBy(-e.decimals);return{vaultId:t,walletAddress:a,balance:b,migrationId:"polygon-pearl"}});async function W(t,a,r){const o=p(r,t.chainId,t.depositTokenAddress),s=await(await x()).getConnectedWeb3Instance(),e=await new s.eth.Contract(w,f).methods.gauges(o.address).call(),c=new s.eth.Contract(A,e),i=S(a,o.decimals);return c.methods.withdraw(i.toString(10))}const E=h("migration/polygon-pearl/execute",async({vaultId:t,t:a,migrationId:r},{getState:o,dispatch:d})=>{const s=[],n=o(),e=m(n,t),c=p(n,e.chainId,e.depositTokenAddress),{balance:i}=v(n,t,r),g=await W(e,i,n);s.push({step:"migration",message:a("Vault-MigrationStart"),action:l.migrateUnstake(g,e,i.shiftedBy(c.decimals),r),pending:!1,extraInfo:{vaultId:t}}),k(c)&&I(n,c.chainId,c.address,e.earnContractAddress).lt(i)&&s.push({step:"approve",message:a("Vault-ApproveMsg"),action:l.approval(c,e.earnContractAddress),pending:!1}),s.push({step:"deposit",message:a("Vault-TxnConfirm",{type:a("Deposit-noun")}),action:l.deposit(e,i,!0),pending:!1,extraInfo:{vaultId:e.id}}),d(B(s,e.chainId))}),R={update:V,execute:E};export{E as executePearlAction,V as fetchPearlStakedBalance,R as migrator};
